<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Tic Tac Toe</title>

<style>
    body {
        background: #111;
        color: #eee;
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
        margin-top: 20px;
    }

    #bigBoard {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 6px;
    }

    .smallBoard {
        display: grid;
        grid-template-columns: repeat(3, 40px);
        gap: 3px;
        background: #333;
        padding: 6px;
        border-radius: 6px;
    }

    .cell {
        width: 40px;
        height: 40px;
        background: #222;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 26px;
        cursor: pointer;
        border-radius: 3px;
    }

    .cell:hover {
        background: #444;
    }

    .disabled {
        pointer-events: none;
        opacity: 0.35;
    }

    .highlight {
        outline: 3px solid yellow;
    }

    .wonBoard {
        background: #005500 !important;
        color: #fff !important;
        font-size: 40px;
        justify-content: center;
        align-items: center;
        display: flex;
    }

</style>
</head>
<body>

<h2>Ultimate Tic Tac Toe</h2>
<div id="playerInfo"></div>

<div id="bigBoard"></div>

<script>
    const bigBoard = document.getElementById("bigBoard");
    const playerInfo = document.getElementById("playerInfo");

    // Sorteio do primeiro jogador
    let currentPlayer = Math.random() < 0.5 ? "X" : "O";
    playerInfo.textContent = "Primeiro jogador: " + currentPlayer;

    // tabuleiros pequenos
    let boards = [];
    let bigBoardState = Array(9).fill("");

    // controle da jogada obrigatória
    let forcedBoard = -1;

    // cria os 9 tabuleiros
    for (let i = 0; i < 9; i++) {
        const small = document.createElement("div");
        small.classList.add("smallBoard");
        small.dataset.index = i;

        let cells = [];

        for (let j = 0; j < 9; j++) {
            const cell = document.createElement("div");
            cell.classList.add("cell");
            cell.dataset.pos = j;
            cell.addEventListener("click", () => play(i, j));
            small.appendChild(cell);
            cells.push(cell);
        }

        boards.push(cells);
        bigBoard.appendChild(small);
    }

    function checkWin(board) {
        const wins = [
            [0,1,2],[3,4,5],[6,7,8],
            [0,3,6],[1,4,7],[2,5,8],
            [0,4,8],[2,4,6]
        ];

        for (const w of wins) {
            const [a,b,c] = w;
            if (
                board[a].textContent &&
                board[a].textContent === board[b].textContent &&
                board[a].textContent === board[c].textContent
            ) return board[a].textContent;
        }

        if (board.every(c => c.textContent !== "")) return "T"; // velha
        return null;
    }

    function checkBigWin() {
        const wins = [
            [0,1,2],[3,4,5],[6,7,8],
            [0,3,6],[1,4,7],[2,5,8],
            [0,4,8],[2,5,6]
        ];

        for (const w of wins) {
            const [a,b,c] = w;
            if (
                bigBoardState[a] &&
                bigBoardState[a] !== "T" &&
                bigBoardState[a] === bigBoardState[b] &&
                bigBoardState[a] === bigBoardState[c]
            ) {
                alert(`Vitória de ${bigBoardState[a]} no tabuleiro maior!`);
                location.reload();
            }
        }
    }

    function play(boardIndex, cellIndex) {
        // jogada proibida? (tabuleiro não é o exigido)
        if (forcedBoard !== -1 && forcedBoard !== boardIndex && bigBoardState[forcedBoard] === "") return;

        const board = boards[boardIndex];
        const cell = board[cellIndex];

        if (cell.textContent !== "" || bigBoardState[boardIndex] !== "") return;

        cell.textContent = currentPlayer;

        // checa vitória do tabuleiro pequeno
        const result = checkWin(board);

        if (result) {
            bigBoardState[boardIndex] = result;

            const parent = boards[boardIndex][0].parentElement;
            parent.classList.add("wonBoard");
            parent.textContent = result;

            checkBigWin();
        }

        // define qual tabuleiro o próximo jogador deverá jogar
        forcedBoard = cellIndex;

        if (bigBoardState[forcedBoard] !== "") {
            forcedBoard = -1; // tabuleiro escolhido já está fechado → liberdade total
        }

        highlightBoards();

        currentPlayer = currentPlayer === "X" ? "O" : "X";
        playerInfo.textContent = "Vez do jogador: " + currentPlayer;
    }

    function highlightBoards() {
        document.querySelectorAll(".smallBoard").forEach((b,i) => {
            b.classList.remove("highlight");
            b.classList.remove("disabled");

            if (bigBoardState[i] !== "") {
                b.classList.add("disabled");
                return;
            }

            if (forcedBoard === -1) {
                return; // liberdade total
            }

            if (i !== forcedBoard) {
                b.classList.add("disabled");
            } else {
                b.classList.add("highlight");
            }
        });
    }

    highlightBoards();
</script>

</body>
</html>
